<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>06.商品内容放大镜效果</title>
    <link rel="stylesheet" href="./css/reset.css">
    <link rel="stylesheet" href="./css/index.css">
</head>

<body>
    <div class="outer">
        <!-- 头部 -->
        <header class="header">
            <!-- 头部的第一行 -->
            <div class="top">
                <div class="container">
                    <div class="loginList">
                        <p>尚品汇欢迎您！</p>
                        <p>
                            <span>请</span>
                            <a href="###">登录</a>
                            <a href="###" class="register">免费注册</a>
                        </p>
                    </div>
                    <div class="typeList">
                        <a href="###">我的订单</a>
                        <a href="###">我的购物车</a>
                        <a href="###">我的尚品汇</a>
                        <a href="###">尚品汇会员</a>
                        <a href="###">企业采购</a>
                        <a href="###">关注尚品汇</a>
                        <a href="###">合作招商</a>
                        <a href="###">商家后台</a>
                    </div>
                </div>
            </div>
            <!-- 头部第二行 搜索区域 -->
            <div class="bottom">
                <h1 class="logoArea">
                    <a href="###" title="尚品汇" class="logo" target="_blank">
                        <img src="./images/Logo.png" alt="尚品汇">
                    </a>
                </h1>
                <div class="searchArea">
                    <form action="###" class="searchForm">
                        <input type="text" class="inputSearch">
                        <button type="submit">搜索</button>
                    </form>
                </div>
            </div>
        </header>

        <!-- 商品导航分类 -->
        <div class="typeNav">
            <div class="container">
                <h2 class="all">全部商品分类</h2>
                <nav class="nav">
                    <a href="###">服装城</a>
                    <a href="###">美妆馆</a>
                    <a href="###">尚品汇超市</a>
                    <a href="###">全球购</a>
                    <a href="###">闪购</a>
                    <a href="###">团购</a>
                    <a href="###">有趣</a>
                    <a href="###">秒杀</a>
                </nav>
            </div>
        </div>

        <!-- 商品主要内容区域 -->
        <section class="con">
            <!-- 路径导航区域 -->
            <div class="conPoin">
                <a href="###">手机、数码、通讯</a>
                <a href="###">手机</a>
                <a href="###">Apple手机</a>
                <a>iphone 6s系列</a>
            </div>
            <!-- 主要内容区域 -->
            <div class="mainCon">
                <!-- 左侧放大镜区域 -->
                <div class="previewWrap">
                    <!-- 放大镜效果 -->
                    <div class="preview">
                        <div class="jqzoom">
                            <img src="./images/s1.png" alt="">
                            <!-- meng -->
                        </div>
                        <!-- datu -->
                    </div>
                    <!-- 缩略图 -->
                    <div class="specScroll">
                        <a class="prev">&lt;</a>
                        <div class="items">
                            <div class="itemsCon">
                                <img src="./images/s1.png" alt="">
                                <img src="./images/s2.png" alt="">
                                <img src="./images/s3.png" alt="">
                                <img src="./images/s1.png" alt="">
                                <img src="./images/s2.png" alt="">
                                <img src="./images/s3.png" alt="">
                                <img src="./images/s1.png" alt="">
                                <img src="./images/s2.png" alt="">
                                <img src="./images/s3.png" alt="">
                            </div>
                        </div>
                        <a class="next">&gt;</a>
                    </div>
                </div>
                <!-- 商品内容右侧选择区域 -->
                <div class="infoWrap">
                    <div class="info1">
                        <h3 class="infoName">Apple iPhone 6s（A1700）64G玫瑰金色 移动通信电信4G手机</h3>
                        <p class="news">推荐选择下方[移动优惠购],手机套餐齐搞定,不用换号,每月还有花费返</p>
                        <div class="priceArea">
                            <div class="priceArea1">
                                <div class="title">价&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;格</div>
                                <div class="price">
                                    <i>¥</i>
                                    <em>5299</em>
                                    <span>降价通知</span>
                                </div>
                                <div class="remark">
                                    <i>累计评价</i>
                                    <span>62222</span>
                                </div>
                            </div>
                            <div class="priceArea2">
                                <div class="title">促&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;销</div>
                                <div class="fixWidth">
                                    <i class="red-bg">加价购</i>
                                    <em
                                        class="t-gray">满999.00另加20.00元，或满1999.00另加30.00元，或满2999.00另加40.00元，即可在购物车换购热销商品</em>
                                </div>
                            </div>
                        </div>
                        <div class="support">
                            <div class="supportArea">
                                <div class="title">支&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;持</div>
                                <div class="fixWidth">以旧换新，闲置手机回收 4G套餐超值抢 礼品购</div>
                            </div>
                            <div class="supportArea">
                                <div class="title">配&nbsp;送&nbsp;至</div>
                                <div class="fixWidth">广东省 深圳市 宝安区</div>
                            </div>
                        </div>
                    </div>
                    <div class="choose">
                        <div class="chooseArea">
                            <dl>
                                <dt>选择颜色</dt>
                                <dd>金色</dd>
                                <dd>银色</dd>
                                <dd>黑色</dd>
                            </dl>
                            <dl>
                                <dt>内存容量</dt>
                                <dd>16G</dd>
                                <dd>64G</dd>
                                <dd>128G</dd>
                                <dd>256G</dd>
                            </dl>
                            <dl>
                                <dt>选择版本</dt>
                                <dd>公开版</dd>
                                <dd>移动版</dd>
                            </dl>
                            <dl>
                                <dt>购买方式</dt>
                                <dd>官方标配</dd>
                                <dd>优惠移动版</dd>
                                <dd>优惠联通版</dd>
                            </dl>
                        </div>
                        <div class="cartWrap">
                            <div class="controls">
                                <input type="text" value="1" class="itxt">
                                <a href="###" class="plus">+</a>
                                <a href="###" class="mins">-</a>
                            </div>
                            <div class="add">
                                <a href="###" traget="_blank">加入购物车</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
    <script>
        // window.onload是全部资源加载完成之后执行
        // DOMContentLoaded是等待节点加载完成之后执行，DOMContentLoaded是DOM2级事件，所以需要使用addEventListener监听
        window.addEventListener("DOMContentLoaded", function () {
            //每一个功能放在一个函数中去运行
            //1.放大镜效果
            magnifier();
            function magnifier() {
                //获取放大镜外层元素
                var oPreview = document.querySelector(".outer .con .mainCon .previewWrap .preview");
                //获取小图的容器
                var oJqzoom = document.querySelector(".outer .con .mainCon .previewWrap .preview .jqzoom")
                //初始化蒙版元素
                var oMask = null;
                //初始化大图外层
                var oMaxBox = null;
                //初始化大图
                var oMaxImg = null;

                //绑定鼠标移入事件
                // onmouseenter和onmouseover 区别在于是否触发冒泡
                oPreview.onmouseenter = function () {
                    //当鼠标移入元素，创建蒙版，严格书写，当没有蒙版的时候，创建，如果存在 则不创建
                    if (!oMask) {
                        //创建蒙版
                        oMask = document.createElement("div");
                        //给蒙版一个类型，并在less中书写蒙版的样式
                        oMask.className = "mask";
                        //把蒙版插入到小图容器中
                        oJqzoom.appendChild(oMask);
                    }
                    //当没有大图外层的时候，则创建一个大图外层及大图
                    if (!oMaxBox) {
                        //创建大图外层
                        oMaxBox = document.createElement("div");
                        //添加样式
                        oMaxBox.className = "maxbox";
                        //给大图外层插入一个大图
                        oMaxImg = new Image();
                        oMaxImg.src = "./images/b1.png"
                        oMaxBox.appendChild(oMaxImg)

                        //把大图外层插入到页面中
                        oPreview.appendChild(oMaxBox);
                    }

                    //给元素绑定鼠标移动事件
                    oJqzoom.onmousemove = function (e) {
                        //当元素移动的时候，蒙版的位置是  鼠标的clientX-蒙版的一半 - 父级距离屏幕边缘的位置
                        //计算蒙版的位移
                        var maskPosition = {
                            left: e.clientX - oMask.offsetWidth / 2 - oJqzoom.getBoundingClientRect().left,
                            top: e.clientY - oMask.offsetHeight / 2 - oJqzoom.getBoundingClientRect().top
                        }

                        //判断临界值
                        if (maskPosition.left <= 0) {
                            maskPosition.left = 0;
                        } else if (maskPosition.left >= oJqzoom.clientWidth - oMask.offsetWidth) {
                            maskPosition.left = oJqzoom.clientWidth - oMask.offsetWidth;
                        }
                        if (maskPosition.top <= 0) {
                            maskPosition.top = 0;
                        } else if (maskPosition.top >= oJqzoom.clientHeight - oMask.offsetHeight) {
                            maskPosition.top = oJqzoom.clientHeight - oMask.offsetHeight;
                        }


                        //对蒙版进行赋值
                        oMask.style.left = maskPosition.left + "px";
                        oMask.style.top = maskPosition.top + "px";

                        //计算比例：（蒙版总共可以移动的距离/大图能够移动的距离）
                        var scale = (oJqzoom.clientWidth - oMask.offsetWidth) / (oMaxImg.offsetWidth - oMaxBox.clientWidth);
                        // console.log(scale)
                        //计算大图移动的位置
                        var maxPosition = {
                            left: maskPosition.left / scale,
                            top: maskPosition.top / scale
                        }
                        //给大图的定位进行赋值(大图和蒙版移动的方向是相反的)
                        oMaxImg.style.marginLeft = - maxPosition.left + "px";
                        oMaxImg.style.marginTop = - maxPosition.top + "px";


                    }

                    //当放大镜查看结束，鼠标移出
                    oPreview.onmouseleave = function () {
                        //移除DOM节点
                        oJqzoom.removeChild(oMask);
                        oPreview.removeChild(oMaxBox);
                        // console.log(oMask)//元素移除以后，只是移出了DOM

                        //把几个变量恢复初始化
                        //初始化蒙版元素
                        oMask = null;
                        oMaxBox = null;
                        oMaxImg = null;

                        //解绑事件
                        oJqzoom.onmousemove = null;
                        oPreview.onmouseleave = null;


                    }
                }
            }
        })
    </script>
</body>

</html>