(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d22b973"],{f02e:function(t,e,r){"use strict";r.r(e);var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("el-card",[r("CategorySelector",{ref:"cs",on:{categoryChange:t.handleCategoryChange}})],1),t._v(" "),r("el-card",{staticStyle:{"margin-top":"20px"}},[r("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowList,expression:"isShowList"}]},[r("el-button",{attrs:{type:"primary",icon:"el-icon-plus",disabled:!t.category3Id},on:{click:t.showAdd}},[t._v("添加属性")]),t._v(" "),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{data:t.attrs,border:""}},[r("el-table-column",{attrs:{label:"序号",type:"index",width:"80",align:"center"}}),t._v(" "),r("el-table-column",{attrs:{label:"属性名称",prop:"attrName",width:"150"}}),t._v(" "),r("el-table-column",{attrs:{label:"属性值列表"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;e.$index;return t._l(a.attrValueList,(function(e){return r("el-tag",{key:e.id,attrs:{type:"info"}},[t._v("\n              "+t._s(e.valueName)+"\n            ")])}))}}])}),t._v(" "),r("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;e.$index;return[r("hint-button",{attrs:{title:"修改属性",type:"primary",icon:"el-icon-edit",size:"mini"},on:{click:function(e){return t.showUpdate(a)}}}),t._v(" "),r("el-popconfirm",{attrs:{title:"确定删除 "+a.attrName+" 吗?"},on:{onConfirm:function(e){return t.deleteAttr(a.id)}}},[r("HintButton",{attrs:{slot:"reference",title:"删除属性",type:"danger",icon:"el-icon-delete",size:"mini"},slot:"reference"})],1)]}}])})],1)],1),t._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:!t.isShowList,expression:"!isShowList"}]},[r("el-form",{attrs:{inline:""}},[r("el-form-item",{attrs:{label:"属性名"}},[r("el-input",{attrs:{type:"text",placeholder:"请输入属性名"},model:{value:t.attr.attrName,callback:function(e){t.$set(t.attr,"attrName",e)},expression:"attr.attrName"}})],1)],1),t._v(" "),r("el-button",{attrs:{type:"primary",icon:"el-icon-plus",disabled:!t.attr.attrName},on:{click:t.addAttrValue}},[t._v("添加属性值")]),t._v(" "),r("el-button",{on:{click:function(e){t.isShowList=!0}}},[t._v("取消")]),t._v(" "),r("el-table",{staticStyle:{margin:"20px 0"},attrs:{border:"",data:t.attr.attrValueList}},[r("el-table-column",{attrs:{label:"序号",type:"index",width:"80",align:"center"}}),t._v(" "),r("el-table-column",{attrs:{label:"属性值名称"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row,n=e.$index;return[a.edit?r("el-input",{ref:n,attrs:{placeholder:"请输入名称",size:"mini"},on:{blur:function(e){return t.toList(a)}},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.toList(a)}},model:{value:a.valueName,callback:function(e){t.$set(a,"valueName",e)},expression:"row.valueName"}}):r("span",{staticStyle:{display:"inline-block",width:"100%"},on:{click:function(e){return t.toEdit(a,n)}}},[t._v(t._s(a.valueName))])]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row,n=e.$index;return[r("el-popconfirm",{attrs:{title:"确定删除 "+a.valueName+" 吗?"},on:{onConfirm:function(e){return t.attr.attrValueList.splice(n,1)}}},[r("hint-button",{attrs:{slot:"reference",title:"删除",type:"danger",icon:"el-icon-delete",size:"mini"},slot:"reference"})],1)]}}])})],1),t._v(" "),r("el-button",{attrs:{type:"primary",disabled:!t.attr.attrName||0===t.attr.attrValueList.length},on:{click:t.addOrUpdate}},[t._v("保存")]),t._v(" "),r("el-button",{on:{click:function(e){t.isShowList=!0}}},[t._v("取消")])],1)])],1)},n=[],i=(r("96cf"),r("3b8d")),s=r("0644"),o=r.n(s),l={name:"AttrList",data:function(){return{loading:!1,category1Id:null,category2Id:null,category3Id:null,attrs:[],isShowList:!0,attr:{attrName:"",attrValueList:[],categoryId:"",categoryLevel:3}}},watch:{isShowList:function(t){this.$refs.cs.disabled=!t}},mounted:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)})));function e(){return t.apply(this,arguments)}return e}(),methods:{deleteAttr:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$API.attr.remove(e);case 2:r=t.sent,200===r.code?(this.$message.success("删除属性成功"),this.getAttrs()):this.$message.error("删除属性失败");case 4:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),addOrUpdate:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e=this.attr,e.attrValueList=e.attrValueList.filter((function(t){return!!t.valueName&&(delete t.edit,!0)})),0!==e.attrValueList.length){t.next=5;break}return this.$message.warning("至少指定一个属性值名称"),t.abrupt("return");case 5:return t.prev=5,t.next=8,this.$API.attr.save(e);case 8:t.sent,this.$message.success("保存属性成功"),this.isShowList=!0,this.getAttrs(),t.next=16;break;case 14:t.prev=14,t.t0=t["catch"](5);case 16:case"end":return t.stop()}}),t,this,[[5,14]])})));function e(){return t.apply(this,arguments)}return e}(),toList:function(t){if(""!==t.valueName.trim()){var e=2===this.attr.attrValueList.filter((function(e){return e.valueName===t.valueName})).length;if(e)return this.$message.warning("属性名称不能重复"),void(t.valueName="");t.edit=!1}},toEdit:function(t,e){var r=this;t.hasOwnProperty("edit")?t.edit=!0:this.$set(t,"edit",!0),this.$nextTick((function(){return r.$refs[e].focus()}))},addAttrValue:function(){var t=this,e={attrId:this.attr.id,valueName:"",edit:!0};this.attr.attrValueList.push(e),this.$nextTick((function(){return t.$refs[t.attr.attrValueList.length-1].focus()}))},showAdd:function(){this.attr={attrName:"",attrValueList:[],categoryId:this.category3Id,categoryLevel:3},this.isShowList=!1},showUpdate:function(t){this.attr=o()(t),this.isShowList=!1},handleCategoryChange:function(t){var e=t.categoryId,r=t.level;1===r?(this.category2Id=null,this.category3Id=null,this.attrs=[],this.category1Id=e):2===r?(this.category3Id=null,this.attrs=[],this.category2Id=e):(this.category3Id=e,this.getAttrs())},getAttrs:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(){var e,r,a,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.category1Id,r=this.category2Id,a=this.category3Id,this.loading=!0,t.next=4,this.$API.attr.getList(e,r,a);case 4:n=t.sent,this.loading=!1,this.attrs=n.data;case 7:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()}},u=l,c=r("2877"),d=Object(c["a"])(u,a,n,!1,null,null,null);e["default"]=d.exports}}]);