(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4630e38c"],{"28a5":function(t,e,a){"use strict";var n=a("aae3"),r=a("cb7c"),i=a("ebd6"),s=a("0390"),l=a("9def"),u=a("5f1b"),o=a("520a"),c=a("79e5"),p=Math.min,d=[].push,f="split",m="length",h="lastIndex",v=4294967295,g=!c((function(){RegExp(v,"y")}));a("214f")("split",2,(function(t,e,a,c){var b;return b="c"=="abbc"[f](/(b)*/)[1]||4!="test"[f](/(?:)/,-1)[m]||2!="ab"[f](/(?:ab)*/)[m]||4!="."[f](/(.?)(.?)/)[m]||"."[f](/()()/)[m]>1||""[f](/.?/)[m]?function(t,e){var r=String(this);if(void 0===t&&0===e)return[];if(!n(t))return a.call(r,t,e);var i,s,l,u=[],c=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),p=0,f=void 0===e?v:e>>>0,g=new RegExp(t.source,c+"g");while(i=o.call(g,r)){if(s=g[h],s>p&&(u.push(r.slice(p,i.index)),i[m]>1&&i.index<r[m]&&d.apply(u,i.slice(1)),l=i[0][m],p=s,u[m]>=f))break;g[h]===i.index&&g[h]++}return p===r[m]?!l&&g.test("")||u.push(""):u.push(r.slice(p)),u[m]>f?u.slice(0,f):u}:"0"[f](void 0,0)[m]?function(t,e){return void 0===t&&0===e?[]:a.call(this,t,e)}:a,[function(a,n){var r=t(this),i=void 0==a?void 0:a[e];return void 0!==i?i.call(a,r,n):b.call(String(r),a,n)},function(t,e){var n=c(b,t,this,e,b!==a);if(n.done)return n.value;var o=r(t),d=String(this),f=i(o,RegExp),m=o.unicode,h=(o.ignoreCase?"i":"")+(o.multiline?"m":"")+(o.unicode?"u":"")+(g?"y":"g"),I=new f(g?o:"^(?:"+o.source+")",h),A=void 0===e?v:e>>>0;if(0===A)return[];if(0===d.length)return null===u(I,d)?[d]:[];var S=0,w=0,L=[];while(w<d.length){I.lastIndex=g?w:0;var k,y=u(I,g?d:d.slice(w));if(null===y||(k=p(l(I.lastIndex+(g?0:w)),d.length))===S)w=s(d,w,m);else{if(L.push(d.slice(S,w)),L.length===A)return L;for(var x=1;x<=y.length-1;x++)if(L.push(y[x]),L.length===A)return L;w=S=k}}return L.push(d.slice(S)),L}]}))},"469f":function(t,e,a){a("6c1c"),a("1654"),t.exports=a("7d7b")},"5d73":function(t,e,a){t.exports=a("469f")},"60f3":function(t,e,a){},"768b":function(t,e,a){"use strict";var n=a("a745"),r=a.n(n);function i(t){if(r()(t))return t}var s=a("5d73"),l=a.n(s),u=a("c8bb"),o=a.n(u);function c(t,e){if(o()(Object(t))||"[object Arguments]"===Object.prototype.toString.call(t)){var a=[],n=!0,r=!1,i=void 0;try{for(var s,u=l()(t);!(n=(s=u.next()).done);n=!0)if(a.push(s.value),e&&a.length===e)break}catch(c){r=!0,i=c}finally{try{n||null==u["return"]||u["return"]()}finally{if(r)throw i}}return a}}function p(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function d(t,e){return i(t)||c(t,e)||p()}a.d(e,"a",(function(){return d}))},"7d7b":function(t,e,a){var n=a("e4ae"),r=a("7cd6");t.exports=a("584a").getIterator=function(t){var e=r(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return n(e.call(t))}},"9ce1":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-form",{directives:[{name:"show",rawName:"v-show",value:t.visible,expression:"visible"}],attrs:{"label-width":"100px"}},[a("el-form-item",{attrs:{label:"SPU名称"}},[a("el-input",{attrs:{placeholder:"SPU名称"},model:{value:t.spuInfo.spuName,callback:function(e){t.$set(t.spuInfo,"spuName",e)},expression:"spuInfo.spuName"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"品牌"}},[a("el-select",{attrs:{placeholder:"请选择品牌"},model:{value:t.spuInfo.tmId,callback:function(e){t.$set(t.spuInfo,"tmId",e)},expression:"spuInfo.tmId"}},t._l(t.trademarkList,(function(t){return a("el-option",{key:t.id,attrs:{label:t.tmName,value:t.id}})})),1)],1),t._v(" "),a("el-form-item",{attrs:{label:"SPU描述"}},[a("el-input",{attrs:{type:"textarea",placeholder:"SPU描述",rows:"4"},model:{value:t.spuInfo.description,callback:function(e){t.$set(t.spuInfo,"description",e)},expression:"spuInfo.description"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"SPU图片"}},[a("el-upload",{attrs:{"file-list":t.spuImageList,action:t.$BASE_API+"/admin/product/fileUpload","list-type":"picture-card","on-preview":t.handlePictureCardPreview,"on-remove":t.handleRemove,"on-success":t.handleUploadSuccess}},[a("i",{staticClass:"el-icon-plus"})]),t._v(" "),a("el-dialog",{attrs:{visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("img",{attrs:{width:"100%",src:t.dialogImageUrl,alt:""}})])],1),t._v(" "),a("el-form-item",{attrs:{label:"销售属性"}},[a("el-select",{attrs:{placeholder:0===t.unUsedSaleAttrList.length?"没有啦!":"还有"+t.unUsedSaleAttrList.length+"未选择"},model:{value:t.attrIdAttrName,callback:function(e){t.attrIdAttrName=e},expression:"attrIdAttrName"}},t._l(t.unUsedSaleAttrList,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id+":"+t.name}})})),1),t._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-plus",disabled:!t.attrIdAttrName},on:{click:t.addSpuSaleAttr}},[t._v("添加销售属性")]),t._v(" "),a("el-table",{staticStyle:{"margin-top":"20px"},attrs:{border:"",data:t.spuInfo.spuSaleAttrList}},[a("el-table-column",{attrs:{label:"序号",type:"index",width:"80",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{label:"属性名",prop:"saleAttrName",width:"150"}}),t._v(" "),a("el-table-column",{attrs:{label:"属性值名称列表"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row,r=e.$index;return[t._l(n.spuSaleAttrValueList,(function(e,r){return a("el-tag",{key:e.id,attrs:{closable:"","disable-transitions":!1},on:{close:function(t){return n.spuSaleAttrValueList.splice(r,1)}}},[t._v("\n            "+t._s(e.saleAttrValueName)+"\n          ")])})),t._v(" "),n.edit?a("el-input",{ref:r,staticClass:"input-new-tag",attrs:{size:"small",placeholder:"名称"},on:{blur:function(e){return t.addSpuSaleAttrValue(n,r)}},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.addSpuSaleAttrValue(n,r)}},model:{value:n.saleAttrValueName,callback:function(e){t.$set(n,"saleAttrValueName","string"===typeof e?e.trim():e)},expression:"row.saleAttrValueName"}}):a("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:function(e){return t.showInput(n,r)}}},[t._v("+ 添加")])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){e.row;var n=e.$index;return[a("hint-button",{attrs:{title:"删除",type:"danger",icon:"el-icon-delete",size:"mini"},on:{click:function(e){return t.spuInfo.spuSaleAttrList.splice(n,1)}}})]}}])})],1)],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.save}},[t._v("保存")]),t._v(" "),a("el-button",{on:{click:t.back}},[t._v("取消")])],1)],1)},r=[],i=(a("ac6a"),a("28a5"),a("768b")),s=(a("96cf"),a("3b8d")),l=(a("7f7f"),{name:"SpuForm",props:{visible:Boolean},data:function(){return{dialogImageUrl:"",dialogVisible:!1,spuId:"",spuInfo:{category3Id:null,spuName:"",description:"",tmId:null,spuSaleAttrList:[],spuImageList:[]},spuImageList:[],trademarkList:[],saleAttrList:[],attrIdAttrName:""}},computed:{unUsedSaleAttrList:function(){var t=this.saleAttrList,e=this.spuInfo.spuSaleAttrList,a=t.filter((function(t){var a=e.some((function(e){return e.saleAttrName===t.name}));return!a}));return a}},methods:{resetData:function(){this.dialogImageUrl="",this.dialogVisible=!1,this.spuId="",this.spuInfo={category3Id:null,spuName:"",description:"",tmId:null,spuSaleAttrList:[],spuImageList:[]},this.spuImageList=[],this.trademarkList=[],this.saleAttrList=[],this.attrIdAttrName=""},save:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e,a,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.spuInfo,a=this.spuImageList,e.spuImageList=a.map((function(t){return{imgName:t.name,imgUrl:t.response?t.response.data:t.imgUrl}})),e.spuSaleAttrList=e.spuSaleAttrList.filter((function(t){return delete t.edit,delete t.saleAttrValueName,t.spuSaleAttrValueList.length>0})),t.next=5,this.$API.spu.addUpdate(e);case 5:n=t.sent,200===n.code?(this.$message.success("保存SPU成功"),this.$emit("update:visible",!1),this.$emit("success"),this.resetData()):this.$message.error("保存SPU失败");case 7:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),back:function(){this.$emit("update:visible",!1),this.$emit("cancel"),this.resetData()},addSpuSaleAttrValue:function(t,e){var a=this,n=t.saleAttrValueName,r=t.baseSaleAttrId;if(n){var i=t.spuSaleAttrValueList.some((function(t){return t.saleAttrValueName==n}));if(i)return this.$message.warning("不能重复"),void this.$nextTick((function(){return a.$refs[e].focus()}));t.spuSaleAttrValueList.push({saleAttrValueName:n,baseSaleAttrId:r}),t.edit=!1,t.saleAttrValueName=""}else t.edit=!1},showInput:function(t,e){var a=this;t.hasOwnProperty("edit")?t.edit=!0:this.$set(t,"edit",!0),this.$nextTick((function(){return a.$refs[e].focus()}))},addSpuSaleAttr:function(){var t=this.attrIdAttrName.split(":"),e=Object(i["a"])(t,2),a=e[0],n=e[1],r={baseSaleAttrId:a,saleAttrName:n,spuSaleAttrValueList:[]};this.spuInfo.spuSaleAttrList.push(r),this.attrIdAttrName=""},initLoadUpdateData:function(t){this.spuId=t,this.getSpuInfo(),this.getSpuImageList(),this.getTrademarkList(),this.getSaleAttrList()},initLoadAddData:function(t){this.spuInfo.category3Id=t,this.getTrademarkList(),this.getSaleAttrList()},getSpuInfo:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$API.spu.get(this.spuId);case 2:e=t.sent,a=e.data,this.spuInfo=a;case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),getSpuImageList:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$API.sku.getSpuImageList(this.spuId);case 2:e=t.sent,a=e.data,a.forEach((function(t){t.name=t.imgName,t.url=t.imgUrl})),this.spuImageList=a;case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),getTrademarkList:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$API.trademark.getList();case 2:e=t.sent,a=e.data,this.trademarkList=a;case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),getSaleAttrList:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$API.spu.getSaleAttrList();case 2:e=t.sent,a=e.data,this.saleAttrList=a;case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),handleUploadSuccess:function(t,e,a){console.log("handleUploadSuccess",t,e,a),this.spuImageList=a},handleRemove:function(t,e){console.log("handleRemove()",t,e),this.spuImageList=e},handlePictureCardPreview:function(t){this.dialogImageUrl=t.url,this.dialogVisible=!0}}}),u=l,o=(a("ee94"),a("2877")),c=Object(o["a"])(u,n,r,!1,null,null,null);e["default"]=c.exports},aae3:function(t,e,a){var n=a("d3f4"),r=a("2d95"),i=a("2b4c")("match");t.exports=function(t){var e;return n(t)&&(void 0!==(e=t[i])?!!e:"RegExp"==r(t))}},ee94:function(t,e,a){"use strict";var n=a("60f3"),r=a.n(n);r.a}}]);