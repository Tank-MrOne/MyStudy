(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-18e79605"],{"0883":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("el-card",{directives:[{name:"show",rawName:"v-show",value:!t.isShowSkuForm,expression:"!isShowSkuForm"}],staticStyle:{"margin-bottom":"20px"}},[s("CategorySelector",{on:{categoryChange:t.handleCategoryChange}})],1),t._v(" "),s("el-card",[s("div",{directives:[{name:"show",rawName:"v-show",value:!t.isShowSpuForm&&!t.isShowSkuForm,expression:"!isShowSpuForm && !isShowSkuForm"}]},[s("el-button",{attrs:{type:"primary",icon:"el-icon-plus",disabled:!t.category3Id},on:{click:t.showSpuAdd}},[t._v("添加SPU")]),t._v(" "),s("el-table",{attrs:{border:"",data:t.spuList}},[s("el-table-column",{attrs:{label:"序号",type:"index",width:"80",align:"center"}}),t._v(" "),s("el-table-column",{attrs:{label:"SPU名称",prop:"spuName"}}),t._v(" "),s("el-table-column",{attrs:{label:"SPU描述",prop:"description"}}),t._v(" "),s("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;e.$index;return[s("hint-button",{attrs:{title:"添加SKU",type:"primary",icon:"el-icon-plus",size:"mini"},on:{click:function(e){return t.showSkuAdd(a)}}}),t._v(" "),s("hint-button",{attrs:{title:"修改SPU",type:"primary",icon:"el-icon-edit",size:"mini"},on:{click:function(e){return t.showSpuUpdate(a)}}}),t._v(" "),s("hint-button",{attrs:{title:"查看所有SKU",type:"info",icon:"el-icon-info",size:"mini"},on:{click:function(e){return t.showSkuList(a)}}}),t._v(" "),s("el-popconfirm",{attrs:{title:"确定删除 "+a.spuName+" 吗?"},on:{onConfirm:function(e){return t.deleteSpu(a.id)}}},[s("hint-button",{attrs:{slot:"reference",title:"删除SPU",type:"danger",icon:"el-icon-delete",size:"mini"},slot:"reference"})],1)]}}])})],1),t._v(" "),s("el-pagination",{staticStyle:{"text-align":"center"},attrs:{"current-page":t.page,"page-sizes":[5,10,15],"page-size":t.limit,total:t.total,layout:"prev, pager, next, jumper, ->, sizes, total"},on:{"current-change":t.getSpuList,"size-change":t.handleSizeChange}})],1),t._v(" "),s("SpuForm",{ref:"spuForm",attrs:{visible:t.isShowSpuForm},on:{"update:visible":function(e){t.isShowSpuForm=e},success:t.handleSuccess,cancel:t.handleCancel}}),t._v(" "),s("SkuForm",{directives:[{name:"show",rawName:"v-show",value:t.isShowSkuForm,expression:"isShowSkuForm"}],ref:"spuForm",attrs:{cancel:function(){return t.isShowSkuForm=!1}},on:{success:function(e){t.isShowSkuForm=!1}}})],1),t._v(" "),s("el-dialog",{attrs:{title:t.spu.spuName+" => SKU列表",visible:t.isShowDialog},on:{"update:visible":function(e){t.isShowDialog=e}}},[s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoading,expression:"isLoading"}],attrs:{data:t.skuList}},[s("el-table-column",{attrs:{prop:"skuName",label:"名称"}}),t._v(" "),s("el-table-column",{attrs:{property:"price",label:"价格(元)"}}),t._v(" "),s("el-table-column",{attrs:{property:"weight",label:"重量(KG)"}}),t._v(" "),s("el-table-column",{attrs:{label:"默认图片"},scopedSlots:t._u([{key:"default",fn:function(t){var e=t.row;return[s("img",{staticStyle:{width:"100px",height:"100px"},attrs:{src:e.skuDefaultImg,alt:""}})]}}])})],1)],1)],1)},i=[],n=s("db72"),r=(s("96cf"),s("3b8d")),l=s("9ce1"),u=s("d183"),o={name:"SpuList",data:function(){return{category1Id:"",category2Id:"",category3Id:"",spuList:[],total:0,page:1,limit:5,isShowSpuForm:!1,isShowSkuForm:!1,isLoading:!1,isShowDialog:!1,spu:{},skuList:[]}},mounted:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)})));function e(){return t.apply(this,arguments)}return e}(),methods:{showSkuAdd:function(t){this.isShowSkuForm=!0,t=Object(n["a"])({},t),t.category1Id=this.category1Id,t.category2Id=this.category2Id,this.$refs.spuForm.initLoadAddData(t)},showSkuList:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e){var s,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.isShowDialog=!0,this.spu=e,this.skuList=[],this.isLoading=!0,t.next=6,this.$API.sku.getListBySpuId(e.id);case 6:s=t.sent,this.isLoading=!1,a=s.data,this.skuList=a;case 10:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),deleteSpu:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$API.spu.remove(e);case 2:t.sent,this.$message.success("删除SPU成功"),this.getSpuList();case 5:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),handleSuccess:function(){this.getSpuList(this.spuId?this.page:1),this.spuId=null},handleCancel:function(){this.spuId=null},showSpuUpdate:function(t){this.spuId=t.id,this.isShowSpuForm=!0,this.$refs.spuForm.initLoadUpdateData(t.id)},showSpuAdd:function(){this.isShowSpuForm=!0,this.$refs.spuForm.initLoadAddData(this.category3Id)},handleCategoryChange:function(t){var e=t.categoryId,s=t.level;1===s?(this.category2Id="",this.category3Id="",this.spuList=[],this.total=0,this.category1Id=e):2===s?(this.category3Id="",this.spuList=[],this.total=0,this.category2Id=e):(this.category3Id=e,this.getSpuList(1))},getSpuList:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e,s,a,i,n,r=arguments;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=r.length>0&&void 0!==r[0]?r[0]:1,this.page=e,t.next=4,this.$API.spu.getList(e,this.limit,this.category3Id);case 4:s=t.sent,a=s.data,i=a.records,n=a.total,this.spuList=i,this.total=n;case 8:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),handleSizeChange:function(t){this.limit=t,this.getSpuList()}},components:{SpuForm:l["default"],SkuForm:u["default"]}},c=o,p=s("2877"),d=Object(p["a"])(c,a,i,!1,null,null,null);e["default"]=d.exports},"5df3":function(t,e,s){"use strict";var a=s("02f4")(!0);s("01f9")(String,"String",(function(t){this._t=String(t),this._i=0}),(function(){var t,e=this._t,s=this._i;return s>=e.length?{value:void 0,done:!0}:(t=a(e,s),this._i+=t.length,{value:t,done:!1})}))},d183:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-form",{attrs:{"label-width":"100px"}},[s("el-form-item",{attrs:{label:"SPU 名称"}},[s("span",[t._v(t._s(t.spu.spuName))])]),t._v(" "),s("el-form-item",{attrs:{label:"SKU 名称"}},[s("el-input",{attrs:{type:"text",placeholder:"SKU 名称"},model:{value:t.skuInfo.skuName,callback:function(e){t.$set(t.skuInfo,"skuName",e)},expression:"skuInfo.skuName"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"价格(元)"}},[s("el-input",{attrs:{type:"number",placeholder:"SKU 价格"},model:{value:t.skuInfo.price,callback:function(e){t.$set(t.skuInfo,"price",e)},expression:"skuInfo.price"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"重量(千克)"}},[s("el-input",{attrs:{type:"number",placeholder:"SKU 重量"},model:{value:t.skuInfo.weight,callback:function(e){t.$set(t.skuInfo,"weight",e)},expression:"skuInfo.weight"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"规格描述"}},[s("el-input",{attrs:{type:"textarea",placeholder:"SKU 规格描述",rows:"4"},model:{value:t.skuInfo.skuDesc,callback:function(e){t.$set(t.skuInfo,"skuDesc",e)},expression:"skuInfo.skuDesc"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"平台属性"}},[s("el-form",{attrs:{inline:"","label-width":"100px"}},t._l(t.attrList,(function(e){return s("el-form-item",{key:e.id,staticStyle:{margin:"5px 0"},attrs:{label:e.attrName}},[s("el-select",{attrs:{placeholder:"请输入"},model:{value:e.attrIdValueId,callback:function(s){t.$set(e,"attrIdValueId",s)},expression:"attr.attrIdValueId"}},t._l(e.attrValueList,(function(t){return s("el-option",{key:t.id,attrs:{label:t.valueName,value:e.id+":"+t.id}})})),1)],1)})),1)],1),t._v(" "),s("el-form-item",{attrs:{label:"销售属性"}},[s("el-form",{attrs:{inline:"","label-width":"100px"}},t._l(t.spuSaleAttrList,(function(e){return s("el-form-item",{key:e.id,staticStyle:{margin:"5px 0"},attrs:{label:e.saleAttrName}},[s("el-select",{attrs:{placeholder:"请输入"},model:{value:e.saleAttrValueId,callback:function(s){t.$set(e,"saleAttrValueId",s)},expression:"attr.saleAttrValueId"}},t._l(e.spuSaleAttrValueList,(function(t){return s("el-option",{key:t.id,attrs:{label:t.saleAttrValueName,value:t.id}})})),1)],1)})),1)],1),t._v(" "),s("el-form-item",{attrs:{label:"图片列表"}},[s("el-table",{attrs:{border:"",data:t.spuImageList},on:{"selection-change":t.handleSelectionChange}},[s("el-table-column",{attrs:{type:"selection",width:"55"}}),t._v(" "),s("el-table-column",{attrs:{label:"图片"},scopedSlots:t._u([{key:"default",fn:function(t){var e=t.row;return[s("img",{staticStyle:{width:"100px",height:"100px"},attrs:{src:e.imgUrl,alt:""}})]}}])}),t._v(" "),s("el-table-column",{attrs:{label:"名称",prop:"imgName"}}),t._v(" "),s("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;e.$index;return["1"===a.isDefault?s("el-tag",{attrs:{type:"success"}},[t._v("默认")]):s("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.setDefault(a)}}},[t._v("设为默认")])]}}])})],1)],1),t._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:t.save}},[t._v("保存")]),t._v(" "),s("el-button",{on:{click:t.back}},[t._v("取消")])],1)],1)},i=[],n=(s("5df3"),s("28a5"),s("768b")),r=(s("ac6a"),s("96cf"),s("3b8d")),l={name:"SkuForm",props:{cancel:Function},data:function(){return{spu:{},skuInfo:{category3Id:null,spuId:null,tmId:null,skuName:null,skuDesc:null,price:null,weight:null,skuDefaultImg:null,skuAttrValueList:[],skuSaleAttrValueList:[],skuImageList:[]},attrList:[],spuSaleAttrList:[],spuImageList:[],selectedSpuImageList:[]}},methods:{resetData:function(){this.spu={},this.skuInfo={category3Id:null,spuId:null,tmId:null,skuName:null,skuDesc:null,price:null,weight:null,skuDefaultImg:null,skuAttrValueList:[],skuSaleAttrValueList:[],skuImageList:[]},this.attrList=[],this.spuSaleAttrList=[],this.spuImageList=[],this.selectedSpuImageList=[]},back:function(){this.resetData(),this.cancel()},save:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e,s,a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.skuInfo,s=this.attrList,a=this.spuSaleAttrList,i=this.selectedSpuImageList,s.forEach((function(t){if(t.attrIdValueId){var s=t.attrIdValueId.split(":"),a=Object(n["a"])(s,2),i=a[0],r=a[1];e.skuAttrValueList.push({attrId:i,valueId:r})}})),e.skuSaleAttrValueList=a.reduce((function(t,e){return e.saleAttrValueId&&t.push({saleAttrValueId:e.saleAttrValueId}),t}),[]),e.skuImageList=i.map((function(t){return{imgName:t.imgName,imgUrl:t.imgUrl,spuImgId:t.id,isDefault:t.isDefault}})),t.next=6,this.$API.sku.addUpdate(e);case 6:this.$message.success("保存SKU成功"),this.resetData(),this.$emit("success");case 9:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),handleSelectionChange:function(t){console.log("handleSelectionChange()",t),this.selectedSpuImageList=t},setDefault:function(t){this.spuImageList.forEach((function(t){return t.isDefault="0"})),t.isDefault="1",this.skuInfo.skuDefaultImg=t.imgUrl},initLoadAddData:function(t){this.spu=t,this.skuInfo.category3Id=t.category3Id,this.skuInfo.spuId=t.id,this.skuInfo.tmId=t.tmId,this.getAddData()},getAddData:function(){var t=this,e=this.spu,s=e.category1Id,a=e.category2Id,i=e.category3Id,n=e.id,r=this.$API.attr.getList(s,a,i),l=this.$API.sku.getSpuSaleAttrList(n),u=this.$API.sku.getSpuImageList(n);Promise.all([r,l,u]).then((function(e){var s=e[0].data,a=e[1].data,i=e[2].data.map((function(t){return t.isDefault="0",t}));t.attrList=s,t.spuSaleAttrList=a,t.spuImageList=i}))}}},u=l,o=s("2877"),c=Object(o["a"])(u,a,i,!1,null,null,null);e["default"]=c.exports}}]);